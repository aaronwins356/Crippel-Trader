<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Croc-Bot Control Deck</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha512-oHDEc8Xed3hA6Sn1k+6whhtjfiPgkBC5T9jp+1rssZCvSOqtEtFPd0PfrxGX2YeliYg+6TSdO7V5fg3d9P2ygA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="static/styles.css" />
</head>
<body>
  <div class="layout">
    <header class="app-header">
      <div>
        <h1>üêä Croc-Bot Control Deck</h1>
        <p class="subtitle">Manage configuration, monitor trades, and collaborate with your local AI assistant.</p>
      </div>
      <button id="theme-toggle" type="button" aria-label="Toggle dark mode">Toggle theme</button>
    </header>

    <main class="grid">
      <section class="card" id="config-panel">
        <header class="card-header">
          <h2>Configuration Editor</h2>
          <div class="card-actions">
            <button type="button" id="config-reload">Reload</button>
            <button type="button" id="config-save">Download JSON</button>
          </div>
        </header>
        <p class="card-description">Edit <code>config.json</code> directly in the browser. Validation happens locally before you export updates.</p>
        <div id="config-errors" class="alert" role="alert" aria-live="assertive"></div>
        <form id="config-form" autocomplete="off">
          <fieldset>
            <legend>Trading</legend>
            <label>Mode
              <select id="trading-mode" name="trading.mode">
                <option value="paper">Paper</option>
                <option value="live">Live</option>
              </select>
            </label>
            <label>Initial capital (USD)
              <input type="number" id="initial-capital" name="trading.initial_capital" min="0" step="0.01" required />
            </label>
            <label>Aggression (1-10)
              <input type="number" id="aggression" name="trading.aggression" min="1" max="10" step="1" required />
            </label>
            <label>Symbols (comma separated)
              <input type="text" id="symbols" name="trading.symbols" placeholder="XBT/USD,ETH/USD" required />
            </label>
          </fieldset>
          <fieldset>
            <legend>Exchange &amp; Notifications</legend>
            <label>Kraken API key
              <input type="password" id="kraken-key" name="api.kraken_key" autocomplete="off" />
            </label>
            <label>Kraken API secret
              <input type="password" id="kraken-secret" name="api.kraken_secret" autocomplete="off" />
            </label>
            <label>Discord webhook
              <input type="url" id="discord-webhook" name="api.discord_webhook" autocomplete="off" />
            </label>
          </fieldset>
          <fieldset>
            <legend>LLM Assistant</legend>
            <label>Endpoint (LM Studio base URL)
              <input type="url" id="llm-endpoint" name="llm.endpoint" placeholder="http://127.0.0.1:1234" required />
            </label>
            <label>Model name
              <input type="text" id="llm-model" name="llm.model" required />
            </label>
            <label>Temperature
              <input type="number" id="llm-temperature" name="llm.temperature" min="0" max="1" step="0.05" />
            </label>
          </fieldset>
          <fieldset class="two-column">
            <legend>Fees &amp; Runtime</legend>
            <label>Maker fee
              <input type="number" id="maker-fee" name="fees.maker" min="0" max="0.1" step="0.0001" required />
            </label>
            <label>Taker fee
              <input type="number" id="taker-fee" name="fees.taker" min="0" max="0.1" step="0.0001" required />
            </label>
            <label>Log level
              <input type="text" id="log-level" name="runtime.log_level" placeholder="INFO" />
            </label>
            <label class="checkbox-row">
              <input type="checkbox" id="read-only" name="runtime.read_only_mode" />
              <span>Read-only mode</span>
            </label>
          </fieldset>
        </form>
      </section>

      <section class="card" id="log-panel">
        <header class="card-header">
          <h2>Trade Log</h2>
          <span class="status-pill" id="trade-log-status">Waiting‚Ä¶</span>
        </header>
        <p class="card-description">Live updates pulled from <code>logs/trades.jsonl</code>. The UI automatically merges new lines without reloading the page.</p>
        <div class="table-wrapper">
          <table id="trade-table" aria-label="Recent trades">
            <thead>
              <tr>
                <th>Time</th>
                <th>Symbol</th>
                <th>Side</th>
                <th>Size</th>
                <th>Price</th>
                <th>Capital</th>
                <th>Stop loss</th>
                <th>Mode</th>
                <th>Fee</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section class="card" id="chart-panel">
        <header class="card-header">
          <h2>Kraken Live Data</h2>
          <span class="status-pill" id="ws-status">Disconnected</span>
        </header>
        <p class="card-description">Subscribe directly to Kraken public WebSocket feeds. Symbols are validated before connecting.</p>
        <form id="symbol-form" class="symbol-form">
          <label for="symbol-input">Symbol</label>
          <input id="symbol-input" type="text" placeholder="BTC/USD" autocomplete="off" />
          <button type="submit">Connect</button>
        </form>
        <div id="symbol-errors" class="alert" role="alert" aria-live="assertive"></div>
        <dl class="ticker-grid" aria-live="polite">
          <div><dt>Bid</dt><dd id="bid">‚Äî</dd></div>
          <div><dt>Ask</dt><dd id="ask">‚Äî</dd></div>
          <div><dt>Last trade</dt><dd id="last-trade">‚Äî</dd></div>
          <div><dt>24h volume</dt><dd id="volume">‚Äî</dd></div>
        </dl>
        <canvas id="price-chart" width="800" height="300" role="img" aria-label="OHLC close chart"></canvas>
      </section>

      <section class="card" id="assistant-panel">
        <header class="card-header">
          <h2>LLM Assistant</h2>
        </header>
        <p class="card-description">Chat with a local LM Studio model. Responses support Markdown and code blocks. Edit before applying changes.</p>
        <div class="chat-window" id="chat-window" role="log" aria-live="polite"></div>
        <textarea id="chat-input" rows="4" placeholder="Ask for a refactor, paste a stack trace, or request code improvements."></textarea>
        <div class="chat-actions">
          <button id="send-chat" type="button">Send</button>
          <button id="clear-chat" type="button">Clear</button>
        </div>
        <label class="preview-label" for="assistant-preview">Apply-to-file preview</label>
        <textarea id="assistant-preview" rows="6" placeholder="Assistant responses will appear here. Edit before saving."></textarea>
        <div class="chat-actions">
          <button id="copy-preview" type="button">Copy preview</button>
        </div>
      </section>
    </main>
  </div>

  <script type="module" src="static/js/app.js"></script>
</body>
</html>
